# ナレッジベース内のドキュメントの管理

## ナレッジベース内のドキュメントの編集

### ドキュメントの追加

ナレッジベースは複数のドキュメントから構成されています。ドキュメントは、ローカルからのアップロードのほか、他のオンラインデータソースからのインポートにも対応しています。ナレッジベース内の各ドキュメントは、データソース上の “1ファイル” に相当し、たとえば Notion 内の1件のドキュメントや、Web上のオンラインドキュメントなどが該当します。

既に作成済みのナレッジベースに新たなドキュメントを追加するには、「ナレッジベース」 → 「ドキュメント一覧」 → 「ファイル追加」をクリックしてください。

<figure><img src="https://assets-docs.dify.ai/2024/12/424ab491aaebe09b490a36d26c9fa8da.png" alt=""><figcaption><p>ナレッジベースに新しいドキュメントをアップロード</p></figcaption></figure>

### ドキュメントの有効化／無効化／アーカイブ／削除

**有効化**：通常使用可能な状態のドキュメントは、編集およびナレッジベース内での検索が可能です。無効化されたドキュメントは後から再び有効化できます。また、一度アーカイブされたドキュメントは、アーカイブ解除後にのみ再有効化が可能となります。

**無効化**：AIアプリケーション利用時に検索対象から除外したいドキュメントについては、該当ドキュメント右側にある青いスイッチをオフにすることで無効化できます。なお、無効化後も内容の編集は可能です。

**アーカイブ**：今後削除せずに保存しておきたい古いドキュメントの場合、アーカイブ機能をご利用ください。アーカイブされたドキュメントは閲覧や削除は可能ですが、再編集はできません。アーカイブは、ナレッジベースのドキュメント一覧から該当ボタンをクリックするか、ドキュメント詳細画面から操作できます。**アーカイブ操作は後から取り消し可能です。**

**削除**：⚠️ 削除は取り消し不可能なため、誤ったドキュメントや内容が曖昧なものについては、ドキュメント右側のメニューから削除してください。削除したドキュメントは復元できませんので、慎重に操作してください。

> 上記の各操作は、複数のドキュメントを同時に選択した状態で一括実行することも可能です。

<figure><img src="https://assets-docs.dify.ai/2024/12/5e0e64859a1ac51602d167ec55ef9350.png" alt=""><figcaption><p>ドキュメントの無効化またはアーカイブ</p></figcaption></figure>

**注意：**

ナレッジベース内で長期間更新がなく、または検索対象とならなかったドキュメントについては、システムの効率運用を考慮し、一時的に無効化される場合があります。

* Sandbox／Free プランのユーザーでは、利用されていないナレッジベース内のドキュメントは **7日後** に自動で無効化されます。  
* Professional／Team プランのユーザーでは、同様のドキュメントが **30日後** に自動で無効化されます。

いつでもナレッジベースへアクセスし、再度有効化することで通常利用に戻すことが可能です。なお、料金プランをご利用のユーザーは **「一括復元」** 機能によって、無効化された全ドキュメントを迅速に有効化できます。

![一括復元されたドキュメント](https://assets-docs.dify.ai/2024/12/bf6485b17aec716741eb65e307c2274c.png)

***

## テキスト分割の管理

### テキスト分割の表示

ナレッジベースにアップロードされた各ドキュメントは、テキスト分割（Chunks）形式で格納されます。ドキュメントタイトルをクリックすると、詳細画面でそのドキュメントの分割リストが表示され、初期状態では1ページにつき10のブロックが表示されます。ページ下部の設定にて、1ページあたりの表示件数を調整可能です。

各ブロックは、先頭2行のプレビューを提示します。ブロック内の全内容を確認したい場合は、「分割を展開」ボタンをクリックしてください。

<figure><img src="https://assets-docs.dify.ai/2024/12/86cc80f17fab1eea75aa73ee681e4663.png" alt=""><figcaption><p>コンテンツ分割の展開</p></figcaption></figure>

また、フィルター機能を利用することで、有効／無効状態のドキュメントをすばやく確認できます。

![ドキュメント分割のフィルタリング](https://assets-docs.dify.ai/2025/01/47ef07319175a102bfd1692dcc6cac9b.png)

なお、各種[テキスト分割モード](../create-knowledge-and-upload-documents/chunking-and-cleaning-text.md)により、分割表示の方法が異なります。

{% tabs %}
{% tab title="汎用モード" %}
**汎用モード**

[汎用モード](../create-knowledge-and-upload-documents/#tong-yong)では、各テキスト分割は独立したブロックとして扱われます。ブロック内の全内容を確認する場合は、右上隅の全画面アイコンをクリックして全画面表示モードに切り替えてください。

![全画面表示モード](https://assets-docs.dify.ai/2024/12/c37a1a247092cda9433a10243543698f.png)

また、上部のドキュメントタイトルをクリックすることで、ナレッジベース内の他ドキュメントへの迅速な切り替えが可能です。

![汎用モード - コンテンツ分割](https://assets-docs.dify.ai/2024/12/4422286c6d254e13c1ab59b147f0ffbf.png)
{% endtab %}

{% tab title="親子モード" %}
**親子モード**

[親子モード](../create-knowledge-and-upload-documents/#fu-zi-fen-duan)の場合、表示される内容は「親分割」と「子分割」に区分されます。

• 　**親分割**

    ナレッジベース内の任意のドキュメントを選択すると、まず親分割が表示されます。親分割には、**「段落」** と **「全文」** の2種類の表示モードがあり、より豊富な文脈情報を提供します。下図は各モードにおけるテキストプレビューの違いを示しています。

<figure><img src="https://assets-docs.dify.ai/2024/12/b3961da2536dc922496ef6646315b9f4.png" alt=""><figcaption><p>段落と全文表示のプレビューの違い</p></figcaption></figure>

• 　**子分割**

    子分割は、通常、親分割内の1文などの小さなテキストブロックで、詳細情報を含みます。各ブロックには文字数および検索での召喚回数が表示されます。子分割ブロックをクリックすると、詳細内容が表示され、右上の全画面アイコンをクリックすれば全内容を表示できます。

![親子モード - コンテンツ分割](https://assets-docs.dify.ai/2024/12/c0776f91e155bb1c961ae255bb98f39e.png)
{% endtab %}

{% tab title="Q&A モード（コミュニティ版のみ）" %}
**Q&A モード**

Q&A モードでは、1つのブロック内に「質問」と「回答」が含まれます。任意のドキュメントタイトルをクリックすると、テキスト分割が表示されます。

![Q&A モード - テキスト分割の表示](https://assets-docs.dify.ai/2024/12/98e2486f6c5e06b4ece1b81d078afa08.png)
{% endtab %}
{% endtabs %}

***

### 分割品質の確認

ドキュメントのテキスト分割は、ナレッジベースを利用した質疑応答システムの精度に大きく影響します。そのため、ナレッジベースとアプリケーションを連携する前に、分割品質を人の目でチェックすることを推奨します。

自動化された文字長、識別子、あるいは NLP の意味解析に基づく分割方法は、大量のテキスト分割作業を大幅に軽減できますが、分割品質はドキュメントの形式や文脈の継続性に依存するため、機械的な処理だけでは十分でない場合があります。人力によるチェックと修正により、機械分割の弱点を補完することが可能です。

分割品質を確認する際、主に以下の点に注意してください。

* **短すぎるテキスト分割**：意味の一部が欠落する可能性があります。

<figure><img src="https://assets-docs.dify.ai/2024/12/ee081e98c1649aea4a5c2b15b88e11aa.png" alt=""><figcaption><p>短すぎるテキスト分割</p></figcaption></figure>

* **長すぎるテキスト分割**：文脈のノイズが生じ、検索精度に影響を与える場合があります。

<figure><img src="https://assets-docs.dify.ai/2024/12/ac47381ae4be183768dd025c37c049fa.png" alt=""><figcaption><p>長すぎるテキスト分割</p></figcaption></figure>

* **強制的な意味の切断**：最大分割長により、意味が途中で切れてしまう場合があり、検索時に情報が欠落する可能性があります。

<figure><img src="https://assets-docs.dify.ai/2024/12/b8ab7ac84028b0b16c3948f35015e069.png" alt=""><figcaption><p>強制的な意味の切断</p></figcaption></figure>

***

### テキスト分割の追加

ナレッジベース内のドキュメントは、必要に応じて個別にテキスト分割を追加することが可能です。なお、分割追加の方法は選択している分割モードにより異なります。

> テキスト分割の追加は有料機能となります。詳細は[こちら](https://dify.ai/pricing)をご確認ください。

{% tabs %}
{% tab title="汎用モード" %}
**汎用モード**

分割リスト上部の「分割を追加」ボタンをクリックすると、ドキュメント内に任意のテキストブロックを1つまたは複数追加できます。

![汎用モード - 分割追加](https://assets-docs.dify.ai/2024/12/552ff4ab9e77130ad09aaef878b19cc9.png)

手動でテキスト分割を追加する際は、本文およびキーワードの入力が可能です。入力後、末尾の **「連続追加」** ボタンにチェックを入れると、引き続き新たな分割を追加できます。

<figure><img src="https://assets-docs.dify.ai/2024/12/cd769622bc1d85c037277ef6fa5247c9.png" alt=""><figcaption><p>汎用モード - テキスト分割の追加</p></figcaption></figure>

また、一括で分割を追加する場合は、まず CSV 形式の分割アップロード用テンプレートをダウンロードします。Excelなどでテンプレートに沿って内容を編集し、CSVファイルとして保存後、アップロードしてください。

<figure><img src="https://assets-docs.dify.ai/2024/12/5e501dd8efba02ff31d2e739417ce864.png" alt=""><figcaption><p>汎用モード - 批量添加自定义分段</p></figcaption></figure>
{% endtab %}

{% tab title="父子モード" %}
**父子モード**

分割リスト上部にある「分割を追加」ボタンをクリックすると、文書内に対して、1つまたは複数のカスタムな**親分割**を一括で追加できます。

<figure><img src="https://assets-docs.dify.ai/2024/12/ed4be3bf178e3a41d53bcc10255ad3b2.png" alt=""><figcaption><p>父子モード — コンテンツブロックの追加</p></figcaption></figure>

内容を入力後、下部にある **「連続追加」** ボタンにチェックを入れることで、引き続きテキストを追加できます。

<figure><img src="https://assets-docs.dify.ai/2024/12/ba64232eea364b68f2e38341eb9cf5c1.png" alt=""><figcaption><p>父子モード — コンテンツブロックの追加</p></figcaption></figure>

また、親分割内において子分割を個別に追加することも可能です。親分割内の子分割右側にある「追加」ボタンをタップすると、子分割を単体で追加できます。

<figure><img src="https://assets-docs.dify.ai/2024/12/23f68a369eb9c1a2cc9022b99a08341d.png" alt=""><figcaption><p>父子モード — 子分割の追加</p></figcaption></figure>
{% endtab %}

{% tab title="Q&Aモード（コミュニティ版のみ）" %}
**Q&Aモード**

分割リスト上部にある「分割を追加」ボタンをクリックすると、文書内に質問と回答のペアによるコンテンツブロックを1つまたは複数追加できます。
{% endtab %}
{% endtabs %}

***

### テキスト分割の編集

{% tabs %}
{% tab title="汎用モード" %}
**汎用モード**

追加された分割の内容は、直接編集・変更が可能です。分割内のテキストやキーワードも自由に変更できます。  
また、重複して編集してしまわないよう、編集後のコンテンツブロックには「編集済み」ラベルが表示されます。

<figure><img src="https://assets-docs.dify.ai/2024/12/8220e412e4c5a2bf729fb5dfcc1b7f4c.png" alt=""><figcaption><p>文書分割の編集</p></figcaption></figure>
{% endtab %}

{% tab title="父子モード" %}
**父子モード**

親分割は、内部に含む子分割の内容を保持していますが、双方は独立して編集可能です。つまり、親分割と子分割の内容はそれぞれ別々に変更できます。
下図は、親子分割間の編集フローを示しています。

![親子分割の編集フロー](https://assets-docs.dify.ai/2024/12/aacdb2e95b9b7c0265455caaf0f1f55f.png)

**親分割の編集**：親分割右側の編集ボタンをクリックし、内容を入力してください。**「保存」**をクリックすると子分割の内容はそのままで、もし子分割の内容も再生成したい場合は **「保存して子分割を再生成」** をクリックしてください。  

編集後、重複編集を防止するため、対象のコンテンツブロックには「編集済み」ラベルが表示されます。

![父子モード — 親分割の編集](https://assets-docs.dify.ai/2024/12/7eedfee59a3c978cc4a29d9cf06fbbcc.png)

**子分割の編集**：任意の子分割を選択し編集モードに入った後、変更が完了したら保存してください。なお、子分割の編集内容は親分割には影響しません。編集または新規追加された子分割には、`C-NUMBER-EDITED`という濃い青色のラベルが付与されます。

また、子分割は現在の親分割のタグと見なすことも可能です。

![父子モード — 子分割の編集](https://assets-docs.dify.ai/2024/12/a59563614d8f4661ebfb20f6b646b4ea.png)
{% endtab %}

{% tab title="Q&Aモード（コミュニティ版のみ）" %}
**Q&Aモード**

Q&Aモードでは、1つのコンテンツブロック内に質問と回答が含まれています。編集したいテキスト分割をクリックすると、質問と回答それぞれの内容を編集できるほか、現在のコンテンツブロックのキーワードも変更可能です。

![Q&Aモード — テキスト分割の編集](https://assets-docs.dify.ai/2024/12/5c69adc0d4ec470d0677e67a4dd894a1.png)
{% endtab %}
{% endtabs %}

### アップロード済み文書のテキスト分割の変更

既存のナレッジベースでは、文書の分割設定を再構成することができます。

**大きい分割** 
- 1つの分割でより多くの文脈（コンテキスト）を保持できるため、複雑なタスクあるいは文脈に依存するタスクに適しています。  
- 分割数が減ることにより、処理時間およびストレージの必要量が削減されます。

**小さい分割** 
- より細かい粒度でテキスト内容の正確な抽出や要約が可能です。  
- モデルのトークン制限を超えるリスクを軽減し、制約が厳しいモデルへの適応性も向上します。

「分割設定」にアクセス後、**保存して処理**ボタンをクリックすることで、分割設定の変更内容が保存され、現在の文書分割処理が再トリガーされます。  
設定保存と埋め込み処理が完了すると、文書の分割リストは自動的に更新され、ページの手動リロードは不要です。

![Chunk Settings](https://assets-docs.dify.ai/2025/01/36cb20be8aae1f368ebf501c0d579051.png)

<img src="https://assets-docs.dify.ai/2025/01/a47b890c575a7693c40303d3d7cb4952.png" width="400" alt="保存して処理">
  
***

### メタデータ管理

メタデータの詳細については、[メタデータ](https://docs.dify.ai/ja-jp/guides/knowledge-base/metadata)を参照してください。